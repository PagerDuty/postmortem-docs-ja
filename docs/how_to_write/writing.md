---
cover:
description: ポストモーテム文書を作成するための具体的なステップを紹介します。ポストモーテムに含めるべき最も重要な情報、その情報の収集と提示方法、そしてシステム改善につながる効果的な分析の実施方法を学びます。
---
![Step by Step](../assets/img/headers/Postmortems-StepByStep.png)

以下は、高レベルでのポストモーテム実施のステップです。各ステップの実施方法の詳細を以下に示します。

1. インシデントの新しいポストモーテムを作成する。
1. 「インシデントポストモーテム会議」共有カレンダーに、必須および任意の参加者のために、必要な時間枠内でポストモーテム会議をスケジュールする。
1. ステータス/影響の重要な変化と対応者が取った主要なアクションをインシデントタイムラインに記入する。
    - タイムラインの各項目について、データの出所となるメトリクスまたはサードパーティのページを含める。
1. インシデントを分析する。
    - 表面的な原因と根本的な原因を特定する。
    - 技術とプロセスの両方を考慮する。
1. フォローアップアクションのチケットを作成する。
1. 外部向けメッセージを作成する。
1. レビューを依頼する。
1. ポストモーテム会議に参加する。
1. ポストモーテムを共有する。

## オーナーの責任
重大なインシデント対応の終了時、またはその直後に、[インシデントコマンダー](https://response.pagerduty.com/training/incident_commander/)は対応者の一人をポストモーテムのオーナーとして選出します。選出されたオーナーはインシデントコマンダーから直接通知を受けます。ポストモーテムの作成は最終的には共同作業となりますが、単一のオーナーを選出することで確実に完了させることができます。

ポストモーテムのオーナーは以下の責任を負います：

- 共有カレンダーにポストモーテム会議をスケジュールし、関連する人々を招待する（Sev-1の場合は3暦日以内、Sev-2の場合は5営業日以内にスケジュールする必要があります）。
- インシデントを調査し、調査に必要な他のチームのメンバーを招集する。
- ページに必要なすべてのコンテンツが更新されていることを確認する。含めるべき内容については[テンプレート](../resources/post_mortem_template.md)を参照してください。
- フォローアップチケットを作成する（オーナーはチケットの作成のみ責任を負い、解決までのフォローアップは責任外です）。
- 会議前に適切な関係者とポストモーテムの内容をレビューし、ポストモーテム会議でトピックを進行する（インシデントコマンダーが会議を「運営」し、議論を軌道に乗せますが、あなたが最も多く話すことになるでしょう）。
- ポストモーテムの結果を社内に伝える。

ポストモーテムのオーナーはポストモーテム文書を作成し、関連するすべての情報で更新します。


## 管理
![Administration](../assets/img/thumbnails/1Administration.png)

1. 文書を作成する。
2. すべての対応者を追加する。
3. 会議をスケジュールする。

インシデントコマンダーによってまだ行われていない場合、ポストモーテムオーナーの最初のステップは、インシデントのための新しい空のポストモーテムを作成することです。Slackの履歴を確認して対応者を特定し、彼らがポストモーテムの作成を手伝えるようにページに追加します。インシデントコマンダーとスクライブも含めてください。インシデント対応の録音へのリンクを追加します。

次に、インシデントの複雑さに応じて30分から1時間のポストモーテム会議をスケジュールします。プロセスの最初に会議をスケジュールすることで、SLA内にポストモーテムが完了することを確保します。**会議はSev-1の場合は3暦日以内、Sev-2の場合は5営業日以内にスケジュールする必要があります。**すべての参加者にとって最適な時間を見つけることを心配する必要はありません。優先事項はこの時間枠内にスケジュールすることであり、参加者はそれに応じてスケジュールを調整する必要があります。PagerDutyでは、すべてのポストモーテム会議を「インシデントポストモーテム会議」共有カレンダーにスケジュールし、組織全体の関心のある人々が簡単に見つけられるようにしています。

ポストモーテム会議には以下の人々を招待します：

- 必須
    - [インシデントコマンダー](https://response.pagerduty.com/training/incident_commander/)。
    - インシデントコマンダーのシャドウイー（いた場合）。
    - インシデントに関与した[サービスオーナー](https://response.pagerduty.com/training/subject_matter_expert/)。
    - インシデントに関与した主要なエンジニア/対応者。
    - 影響を受けたシステムのエンジニアリングマネージャー。
    - 影響を受けたシステムのプロダクトマネージャー。
- 任意
    - [カスタマーリエゾン](https://response.pagerduty.com/training/customer_liaison/)（Sev-1インシデントの場合のみ）。

PagerDutyのポストモーテムには、ポストモーテムが現在プロセスのどの段階にあるかを示す「ステータス」フィールドがあります。以下は、値の説明と使用方法です。

| ステータス | 説明 |
|-|-|
| **ドラフト** | ポストモーテムの内容がまだ作業中であることを示します。 |
| **レビュー中** | ポストモーテムの内容が完成し、ポストモーテム会議でのレビューの準備ができていることを示します。 |
| **レビュー済み** | 会議が終了し、内容がレビューされ合意されたことを示します。<br/>「外部メッセージ」がある場合、カスタマーサポートチームがメッセージを取り、適切にステータスページを更新します。 |
| **クローズ** | ポストモーテムに関するさらなるアクションは必要ありません（未解決の問題はJIRAで追跡されます）。<br/>「外部メッセージ」がない場合、会議終了後にこのステータスに直接移行できます。<br/>「外部メッセージ」がある場合、サポートチームがメッセージを投稿した後にこのステータスに更新します。 |

## タイムラインの作成
![Timeline](../assets/img/thumbnails/2CreateATimeline.png)
まずタイムラインに焦点を当てます。インシデント中に起きた事実を文書化します。何をすべきだったか、何をすべきでなかったか、インシデントの原因は何かといった評価は避けてください。ここで事実のみを提示することで、非難を避け、より深い分析をサポートします。インシデントは対応者が気づき対応を開始する前に始まっていた可能性があることに注意してください。タイムラインにはステータス/影響の重要な変化と対応者が取った主要なアクションを含めます。事後の知恵バイアスを避けるため、タイムラインはインシデント発生前の時点から始め、解決から逆算するのではなく、時系列に沿って進めてください。

Slackのインシデントログを確認して、対応中に行われた重要な決定やアクションを見つけます。また、事後の知恵で見れば知っておきたかったが、インシデント中には知らなかった情報も含めます。この追加情報は、影響を受けたサービスに関連するモニタリング、ログ、デプロイメントを確認することで見つけることができます。分析ステップでモニタリングをより詳しく調査しますが、まずはインシデントに関連する重要なイベントをタイムラインに追加し、インシデントのステータスと影響の変化も含めてください。

タイムラインの各項目について、データの出所となるメトリクスまたはサードパーティのページを特定します。これにより各ポイントが明確に説明され、意見ではなく事実に基づいていることが確保されます。これはモニタリンググラフへのリンク、ログ検索、ツイート、その他タイムラインで説明しようとしているデータポイントを示すものであれば何でも構いません。

!!! info "重要なポイント"
    * 事実に忠実に。
    * インシデントのステータスと影響の変化を含める。
    * 対応者が行った重要な決定とアクションを含める。
    * 各ポイントをメトリクスで説明する。

## 影響の文書化
![Impact](../assets/img/thumbnails/3DocumentImpact.png)
影響はいくつかの観点から説明する必要があります：

- 影響が見られた期間はどれくらいですか？つまり、ユーザー/顧客が影響を受けた時間の長さはどれくらいですか？
    - 影響の長さは対応作業の長さとは異なる場合があることに注意してください。影響は検出され、インシデント対応が始まる前にすでに始まっていた可能性があります。
- 何人の顧客が影響を受けましたか？
    - サポートは、影響を受けたすべての顧客のリストを必要とする場合があり、個別に連絡を取ることができます。
- 何人の顧客がインシデントについてサポートに連絡しましたか？
- どの機能がどの程度影響を受けましたか？
    - 製品に特化したビジネスメトリクスで影響を定量化します。PagerDutyの場合、これにはイベント送信、処理の遅延、通知配信の遅延などが含まれます。

## インシデントの分析
![Analyze](../assets/img/thumbnails/4AnalyzeTheIncident.png)
インシデント中に何が起きたかを理解したら、さらに時間をさかのぼってインシデントにつながった要因を探します。技術は、継続的に変化する関係のネットワーク（組織的、人的、技術的）を持つ複雑なシステムです。

リチャード・クック博士の論文「[How Complex Systems Fail](http://web.mit.edu/2.75/resources/random/How%20Complex%20Systems%20Fail.pdf)」によれば、複雑なシステムは障害に対して強く防御されているため、一見無害な障害が独自の組み合わせで壊滅的な障害を引き起こします。さらに、明白な障害には複数の欠陥が必要なため、「根本原因」を特定することは根本的に間違っています。**複雑なシステムの大きな障害には単一の根本原因はなく、障害が可能になる環境を作り出す複数の要因の組み合わせがあります。**ポストモーテムオーナーのインシデント分析の目標は根本原因を特定することではなく、この障害を可能にした複数の要因を理解することです。

クックはまた、「根本原因」を見つける努力はシステムの理解を反映するものではなく、むしろイベントに対して特定の局所的な力を非難する文化的な必要性を反映していると述べています。非難のなさは効果的なポストモーテムにとって不可欠です。**個人の行動が根本原因と見なされることは決してありません。**効果的な分析は人間の行動よりも深く掘り下げます。誰かのミスが障害に寄与した場合、分析では個人への非難を避けるためにこれを匿名化する価値があります。どのチームメンバーも同じミスを犯す可能性があると仮定してください。クックによれば、「すべての実践者の行動は実際にはギャンブルであり、つまり不確実な結果に直面して行われる行為です。」

ポストモーテムオーナーは、影響を受けたサービスのモニタリングを調査することから分析を始めるべきです。インシデントが始まった時点とその前に、突然のスパイクやフラットラインなどの異常を探します。データがどのように収集されたかを他の人が確認できるように、データを検索するために使用したコマンドやクエリ、グラフ画像、モニタリングツールからのリンクをこの分析と一緒に含めてください。このサービスや動作に対するモニタリングがない場合は、モニタリングの構築をこのポストモーテムのアクションアイテムとしてください。以下の[アクションアイテムの作成](#followup)で詳しく説明します。

!!! warning "モニタリングの重要性"
    Puppetの2018年DevOpsレポートは、サービスを運用するチームがモニタリングを設定できるようにすることが、成功するDevOpsの基本的な実践であることを強調しています。チームが自分たちのパフォーマンス測定を定義、管理、共有できるようにすることは、継続的改善の文化に貢献します。

インシデントの原因を特定するもう一つの有効な戦略は、非本番環境でインシデントを再現することです。変数を変更して現象を分離する実験を行います。入力の一部を変更または削除した場合、インシデントはまだ発生しますか？

このレベルの分析により、インシデントの表面的な原因が明らかになります。次に、このようなことが可能になるようにシステムがどのように設計されたのかを尋ねます。なぜそれらの設計決定が当時最良の決定だと思われたのでしょうか？これらの質問に答えることで、根本原因を明らかにするのに役立ちます。

以下は、ポストモーテムオーナーが特定の問題のクラスを特定するのに役立つ質問です：

- これは孤立したインシデントですか、それともトレンドの一部ですか？
- これは特定のバグ、予想された問題のクラスの障害、または建築的に予想していなかった問題のクラスを明らかにしましたか？
- 過去にチームが行わないことを選択した作業で、このインシデントに寄与したものはありましたか？
- 過去に類似または関連するインシデントがあったかどうかを調査します。このインシデントはシステムのより大きなトレンドを示していますか？
- サービスの使用を継続的に成長させ拡大するにつれて、この種の問題は悪化/より発生しやすくなりますか？

!!! tip
    PagerDutyでは、技術的および組織的な計画に情報を提供するために、複数のインシデントにわたるより大きなトレンドを分析するための別のプロセスがあります。詳細は[運用レビュー](http://reviews.pagerduty.com)に関するガイドをご覧ください。

根本原因ではないかもしれませんが、分析ではプロセスも考慮してください。人々が協力し、コミュニケーションを取り、作業をレビューする方法がインシデントに寄与しましたか？これはまた、インシデント対応プロセスを評価し改善する機会でもあります。インシデント中のインシデント対応プロセスで何がうまくいき、何がうまくいかなかったかを考慮してください。

ポストモーテムに調査結果の要約を書きます。チームは会議での議論を通じてさらなる学びを見つけ、追加の原因を特定するかもしれませんが、オーナーは生産的な議論を確保するために可能な限り事前作業と文書化を行うべきです。

### 質問すべきこと
以下は、深い分析を促進するための網羅的ではないリストです。非難を避け、学習を促進するために、「誰が」や「なぜ」ではなく、「どのように」「何が」という質問をしてください。

<table>
    <tr>
        <td>手がかり</td>
        <td>
            <ul>
                <li>何に注目していましたか？</li>
                <li>何が見落とされていましたか？</li>
                <li>予想と異なっていたのは何でしたか？</li>
            </ul>
        </td>
    </tr>
    <tr>
        <td>過去の知識/経験</td>
        <td>
            <ul>
                <li>これは予想された問題のクラスでしたか、それとも建築的に予想されていなかった問題のクラスを明らかにしましたか？</li>
                <li>参加者は事態の進展についてどのような期待を持っていましたか？</li>
                <li>過去に類似したインシデントはありましたか？</li>
            </ul>
        </td>
    </tr>
    <tr>
        <td>目標</td>
        <td>
            <ul>
                <li>当時のあなたの行動を支配していた目標は何でしたか？</li>
                <li>時間的制約やその他の制限が選択にどのような影響を与えましたか？</li>
                <li>過去にチームが行わないことを選択した作業で、このインシデントを防止または軽減できたものはありましたか？</li>
            </ul>
        </td>
    </tr>
    <tr>
        <td>評価</td>
        <td>
            <ul>
                <li>どのようなミス（例えば、解釈における）が起こりやすかったですか？</li>
                <li>インシデント発生前に、関連するサービスの健全性をどのように見ていましたか？</li>
                <li>このインシデントは、このサービスの健全性に関する見方を変えるべき何かを教えてくれましたか？</li>
            </ul>
        </td>
    </tr>
    <tr>
        <td>行動</td>
        <td>
            <ul>
                <li>どのように事態の流れに影響を与えられると判断しましたか？</li>
                <li>事態の流れに影響を与えるためにどのような選択肢が取られましたか？これらが当時の最善の選択肢であると、どのように判断しましたか？</li>
                <li>他の影響（運用上または組織上）が、状況の解釈や行動の決定にどのように役立ちましたか？</li>
            </ul>
        </td>
    </tr>
    <tr>
        <td>支援</td>
        <td>
            <ul>
                <li>誰かに助けを求めましたか？</li>
                <li>どのような信号があなたにサポートを求めさせましたか？</li>
                <li>連絡する必要のある人々に連絡することはできましたか？</li>
            </ul>
        </td>
    </tr>
    <tr>
        <td>プロセス</td>
        <td>
            <ul>
                <li>人々が協力し、コミュニケーションを取り、作業をレビューする方法がインシデントに寄与しましたか？</li>
                <li>インシデント対応プロセスで上手くいったことと上手くいかなかったことは何ですか？</li>
            </ul>
        </td>
    </tr>
</table>

!!! info "重要なポイント"
    * 根本原因ではなく、寄与要因を見つける。
    * 人間ではなく、システムに焦点を当てる。
    * モニタリングの異常を探す。
    * 非本番環境で再現し実験する。
    * プロセスのレビューを忘れない。

## フォローアップアクション<a name="followup"></a>
![Followup](../assets/img/thumbnails/5FollowUpActions.png)
インシデントの原因を特定した後、これが再び起こらないようにするために何をする必要があるかを考えます。分析に基づいて、この特定のインシデントではなく、この種の問題の発生を減らすための提案もあるかもしれません。

同じインシデントや類似のインシデントが再び発生する可能性を完全に排除することは不可能（または努力に値しない）かもしれないので、将来のインシデントの検出と軽減をどのように改善できるかも考慮してください。チームはこの種の問題に関するより良いモニタリングとアラートが必要で、将来より迅速に対応できるようにする必要がありますか？この種のインシデントが再び発生した場合、チームはどのように重大度や期間を減らすことができますか？インシデント対応プロセスを改善するためのアクションも特定することを忘れないでください。Slackのインシデント履歴を確認して、インシデント中に提起されたすべてのToDoアイテムを見つけ、これらもチケットとして文書化されていることを確認してください。（この段階では、チケットを作成するだけです。ポストモーテム会議の前にタスクが完了することは期待されていません。）

提案されたすべてのフォローアップアクションのチケットをタスク管理ツールで作成します。すべてのチケットに重大度レベルと日付タグを付けて、チケットシステムで簡単に見つけて報告できるようにします。チームのプロダクトオーナーが他の作業と比較してタスクの優先順位を付けるのに十分な情報を持ち、最終的な担当者がタスクを完了するのに十分な情報を持つように、チケットにできるだけ多くのコンテキストと提案された方向性を提供してください。

_;login:_ マガジンの記事「[Postmortem Action Items: Plan the Work and Work the Plan](https://www.usenix.org/system/files/login/articles/login_spring17_09_lunney.pdf)」で、ジョン・ラニー、スー・ルーダー、ベッツィ・ベイヤーはGoogleがポストモーテムのアクションアイテムを迅速かつ簡単に完了させるためにどのように書くかについて説明しています。彼らはすべてのアクションアイテムを実行可能、具体的、かつ範囲が限定されたものとして書くことを勧めています。

- **実行可能：** 各アクションアイテムを動詞で始まる文として表現します。アクションは有用な結果をもたらすべきです。
- **具体的：** 各アクションアイテムの範囲をできるだけ狭く定義し、範囲内と範囲外を明確にします。
- **範囲が限定された：** 各アクションアイテムを、オープンエンドまたは継続的なタスクではなく、いつ終了したかを示すように表現します。

| 不適切な表現 | より良い表現 |
|-|-|
| このシナリオのモニタリングを調査する。 | **実行可能：** このサービスが>1%のエラーを返すすべてのケースのアラートを追加する。 |
| 停止を引き起こした問題を修正する。 | **具体的：** ユーザーアドレスフォーム入力の無効な郵便番号を安全に処理する。 |
| エンジニアが更新前にデータベーススキーマが解析できることを確認するようにする。 | **範囲が限定された：** スキーマ変更の自動事前送信チェックを追加する。 |

<small>出典: _;login:_  Spring 2017 Vol. 42, No. 1.</small>

チケットを作成する前に議論が必要なフォローアップアクションの提案がある場合は、これらの項目をポストモーテム会議の議題に追加するメモを作成してください。これらはチームの検証や明確化が必要な提案かもしれません。会議でこれらの項目を議論することで、どのように進めるのが最善かを決定するのに役立ちます。

あまりにも多くのチケットを作成しないように注意してください。P0/P1のタスク、つまり絶対に対処すべきタスクのみを作成してください。ここにはいくつかのトレードオフがあり、それは問題ありません。時には、インシデントの再発を減らす可能性のあるアクションを実行するために必要な労力に対してROIが価値がない場合があります。その場合、その決定をポストモーテムに文書化する価値があります。チームがアクションを実行しないことを選択する理由を理解することは、学習性無力感を避けるのに役立ちます。

チケットを作成する人がそれを完了する責任を負うわけではないことに注意してください。チケットは影響を受けたサービスを所有するチームのプロジェクトの下で開かれます。フォローアップアクションの責任を負うすべてのチームの代表者が少なくとも1人、ポストモーテム会議に招待されます。


!!! info "重要なポイント"
    * これや類似のインシデントが再発する可能性を減らすために何をする必要がありますか？
    * この種のインシデントをより早く検出するにはどうすればよいですか？
    * この種のインシデントの重大度や期間をどのように減らすことができますか？
    * 実行可能、具体的、かつ範囲が限定されたタスクを書く。

## 外部メッセージの作成
![External](../assets/img/thumbnails/6WriteExternalMessaging.png)
外部メッセージの目標は、技術や組織に関する独自情報を明かすことなく、何が起こったのか、それに対して何をしているのかについて顧客に十分な情報を提供することで信頼を構築することです。内部分析の一部は主に内部の聴衆に利益をもたらし、外部のポストモーテムに含める必要はありません。

外部ポストモーテムは、内部ポストモーテムに使用される情報を要約し、整理したものです。外部ポストモーテムには以下の3つのセクションが含まれます：

1. **要約：** インシデントの期間と観測可能な顧客への影響を要約した2〜3文。
1. **何が起きたか：** 
    - 原因の要約。
    - インシデント中の顧客向け影響の要約。
    - インシデント中の緩和努力の要約。
1. **これに対して何をしているか：** アクションアイテムの要約。

>ヒント：本当に完全な停止でない限り、「停止（outage）」という言葉を使用することは避けてください。代わりに「インシデント」または「サービス低下」という言葉を使用してください。顧客は一般的に「停止」を見て最悪の事態を想定します。

この時点で、外部ポストモーテムはまだ送信または公開すべきではない草案の言語であることに注意してください。ポストモーテム会議で送信前にレビューする必要があります。

## ポストモーテムレビュー
![Review](../assets/img/thumbnails/7PostmortemReview.png)
PagerDutyでは、スタイルと内容についてポストモーテムをレビューするために利用できる経験豊富なポストモーテム作成者のコミュニティがあります。これにより、会議中の無駄な時間を避けることができます。会議がスケジュールされる少なくとも24時間前に、Slackにポストモーテムへのリンクを投稿してフィードバックを受け取ります。

以下は、私たちが探すいくつかのことです：

- 十分な詳細を提供していますか？
- 何が間違っていたかを指摘するだけでなく、問題の根本的な原因を掘り下げていますか？
- 「何が起きたか？」と「どう修正するか」を分けていますか？
- 提案されたアクションアイテムは意味がありますか？十分に範囲が限定されていますか？
- ポストモーテムは適切に書かれ、理解可能ですか？
- 外部メッセージは顧客に共感しますか、それとも怒りを引き起こす可能性がありますか？

ポストモーテムのレビューは誤字脱字を細かく指摘することではありません（ただし、外部メッセージにスペルや文法エラーがないことを確認してください）。それは、ポストモーテムから最大の利益を得るために、ポストモーテムに価値ある変更を加えるための建設的なフィードバックを提供することです。
